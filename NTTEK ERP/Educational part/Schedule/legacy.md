<p align="center"><img src="https://nttek.ru/bitrix/templates/nttek/images/icons/logo_full.png" width="350" alt="Laravel Logo"></p>

***Не требуется авторизация через токен, API свободное и открытое.***

# Расписание (legacy-режим)

В данном разделе описан процесс работы с API расписания legacy-режима. Нижеприведенные примеры будут представлены в виде cURL-запросов, а также в виде JSON-объектов.

Данное API реализовано в НТТЭК ERP, так что доступ к нему происходит непосредственно через API сервиса НТТЭК ERP. **Доступ к API реализован по доменному имени**: https://erp.nttek.ru.

### /api/schedule/legacy/

Получение списка 10 дат, которые есть от сегодняшней даты. В случае, если впереди не 10 дат, то возвращаются предыдущие даты.

Пример запроса
```curl
curl --location --request GET 'https://erp.nttek.ru/api/schedule/legacy/'
```
Пример ответа от сервера:
```json
[
    "14.11.2022",
    "12.11.2022",
    "11.11.2022",
    "10.11.2022",
    "09.11.2022",
    "08.11.2022",
    "07.11.2022",
    "05.11.2022",
    "03.11.2022",
    "02.11.2022"
]
```

### /api/schedule/legacy/{date}

Доступ к расписанию на дату. ```{date}``` должен передаваться в виде ```YYYY-MM-DD```.

Пример запроса:
```curl
curl --location --request GET 'https://erp.nttek.ru/api/schedule/legacy/2022-10-12'
```
Пример ответа от сервера:
```json
{
    "date": "12.10.2022",
    "countOfChanges": 2,
    "lastChange": "2022-10-12T09:29:15.000000Z",
    "url": "https://erp.nttek.ru/storage/2022/10/12/a398ffa00467363f97066869c351f8e7d7b88eac.xlsx",
    "data": {
        "teachers": [
            "List of teachers"
        ],
        "groups": [
            "List of groups"
        ]
    }
}
```
В ответе сервер передает следующие параметры:
1. ```date``` - дата запрошенного расписания в формате ```DD.MM.YYYY```;
2. ```countOfChanges``` - количество изменений в расписании;
3. ```lastChange``` - Отпечаток времени последнего изменения в расписании в UNIX-формате;
4. ```url``` - ссылка на Excel-таблицу с расписанием;
5. ```data``` - список мета-информации о расписании:
  4.1. ```teachers``` - поименный список преподавателей, которые есть в расписании на запрашиваемую дату;
  4.2. ```groups``` - список групп, которые есть в расписании на запрашиваемую дату.

### /api/schedule/legacy/{date}/{type}

Получить расписание на запрошенную ```{date}``` определенного ```{type}```. ```{date}``` должен передаваться в виде ```YYYY-MM-DD```. ```{type}``` может принимать только следующие значения:
  1. ```all``` - получить все расписание;
  2. ```teacher``` - получить расписание на преподавателя;
  3. ```group``` - получить расписание на группу.

В случае, если был передан некорректный ```type```, то ответ от сервера будет следующим с HTTP RESPONSE CODE 404:
```json
{
    "message": "Type can be only: 'teacher', 'group' and 'all'"
}
```

Ответ от сервера при запросе ```all```:
```json
[
    {
        "building": {
            "number": "КОРПУС 1",
            "address": "(Ленина, 2а)"
        },
        "schedule": [
            {
                "name": "3Б2",
                "schedule": [
                    {
                        "lesson": 2,
                        "name": "Основы предпринимательской деятельности",
                        "teachers": [
                            "Дмитриева МГ"
                        ],
                        "rooms": [
                            "ч",
                            "з"
                        ]
                    },
                    {
                        "lesson": 3,
                        "name": "Бухгалтерская технология проведения и оформления инвентаризации",
                        "teachers": [
                            "Пухова ВЛ"
                        ],
                        "rooms": [
                            "213"
                        ]
                    },
                    {
                        "lesson": 0,
                        "name": "Кл. час",
                        "teachers": [
                            "Русских НН"
                        ],
                        "rooms": [
                            "213"
                        ]
                    },
                    {
                        "lesson": 4,
                        "name": "Бухгалтерская технология проведения и оформления инвентаризации",
                        "teachers": [
                            "Пухова ВЛ"
                        ],
                        "rooms": [
                            "213"
                        ]
                    }
                ]
            }
        ]
    },
    {
        "building": {
            "number": "КОРПУС 2",
            "address": "(Садовая, 22)"
        },
        "schedule": [
            {
                "name": "3Р5",
                "schedule": [
                    {
                        "lesson": 2,
                        "name": "Полиграфия в рекламной деятельности",
                        "teachers": [
                            "Краева ЕП"
                        ],
                        "rooms": [
                            "7"
                        ]
                    },
                    {
                        "lesson": 3,
                        "name": "Полиграфия в рекламной деятельности",
                        "teachers": [
                            "Краева ЕП"
                        ],
                        "rooms": [
                            "7"
                        ]
                    },
                    {
                        "lesson": 0,
                        "name": "Кл. час",
                        "teachers": [
                            "Краева ЕП"
                        ],
                        "rooms": [
                            "7"
                        ]
                    }
                ]
            }
        ]
    }
]
```


### /api/schedule/legacy/{date}/{type}/{name?}

Если запрос идет к ```teacher``` или к ```group```, то запрос должен иметь ```name```. ```name``` - это указатель поиска. Если не был указан ```name```, то сервер ответит следующим ответом с HTTP RESPONSE CODE 404:
```json
{
    "message": "Name can't be empty!"
}
```

Если запрос был к ```teacher```, с ```name: Репьев ЕД```. Пример запроса:
```curl
curl --location --request GET 'https://erp.nttek.ru/api/schedule/legacy/2022-10-12/teacher/Репьев%20ЕД'
```

Пример ответа:
```json
{
    "2": {
        "building": {
            "number": "КОРПУС 1",
            "address": "(Ленина, 2а)"
        },
        "group": "3ИС3",
        "name": "Тестирование информационных систем",
        "rooms": [
            "20"
        ]
    },
    "0": {
        "building": {
            "number": "КОРПУС 1",
            "address": "(Ленина, 2а)"
        },
        "group": "3ИС3",
        "name": "Кл. час",
        "rooms": [
            "20"
        ]
    },
    "1": {
        "building": {
            "number": "КОРПУС 1",
            "address": "(Ленина, 2а)"
        },
        "group": "4ИС3",
        "name": "Основы создания и программирования веб-приложений",
        "rooms": [
            "27"
        ]
    },
    "3": {
        "building": {
            "number": "КОРПУС 1",
            "address": "(Ленина, 2а)"
        },
        "group": "4ИС3",
        "name": "Основы создания и программирования веб-приложений",
        "rooms": [
            "27"
        ]
    }
}
```

Если запрос был к group с name: 3ИС3. Пример запроса:
```curl
curl --location --request GET 'https://erp.nttek.ru/api/schedule/legacy/2022-10-12/group/3ИС3'
```

Пример ответа:
```json
{
    "name": "3ИС3",
    "schedule": [
        {
            "lesson": 1,
            "name": "Проектирование и дизайн информационных систем",
            "teachers": [
                "Колчанова ЮВ"
            ],
            "rooms": [
                "29"
            ]
        },
        {
            "lesson": 2,
            "name": "Тестирование информационных систем",
            "teachers": [
                "Репьев ЕД"
            ],
            "rooms": [
                "20"
            ]
        },
        {
            "lesson": 3,
            "name": "Физическая культура",
            "teachers": [
                "Неклеса ЕГ"
            ],
            "rooms": [
                "с",
                "з"
            ]
        },
        {
            "lesson": 0,
            "name": "Кл. час",
            "teachers": [
                "Репьев ЕД"
            ],
            "rooms": [
                "20"
            ]
        }
    ]
}
```
